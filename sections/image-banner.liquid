{{ 'section-image-banner.css' | asset_url | stylesheet_tag }}
<script src='{{ 'image-banner.js' | asset_url }}' defer='defer'></script>

{% liquid
	assign section_heading = section.settings.section_heading
	assign section_subheading = section.settings.subheading
	assign image_ratio = section.settings.image_ratio

	assign image_1 = section.settings.image
	assign image_2 = section.settings.image_1
	assign h_1 = image_1.height
	assign h_2 = image_2.height

	if image_ratio == 'adapt'
		if image_1 != blank and image_2 != blank
			if h_1 > h_2
				assign image_height = image_1.width | divided_by: image_1.aspect_ratio
				assign adapt_height = 1 | divided_by: image_1.aspect_ratio | times: 100 | append: '%'
				assign padding_bottom = h_1
			else
				assign image_height = image_2.width | divided_by: image_2.aspect_ratio
				assign adapt_height = 1 | divided_by: image_2.aspect_ratio | times: 100 | append: '%'
				assign padding_bottom = h_2
			endif
		elsif image_1 == blank and image_2 == blank
			assign aspect_ratio = 0
			assign padding_bottom = 0
		else
			if image_1 != blank
				assign image_height = image_1.width | divided_by: image_1.aspect_ratio
				assign adapt_height = 1 | divided_by: image_1.aspect_ratio | times: 100 | append: '%'
				assign padding_bottom = image_height | append: 'px'
			elsif image_2 != blank
				assign image_height = image_2.width | divided_by: image_2.aspect_ratio
				assign adapt_height = 1 | divided_by: image_2.aspect_ratio | times: 100 | append: '%'
				assign padding_bottom = image_height | append: 'px'
			endif
		endif
	elsif image_ratio == 'large'
		assign padding_bottom = '100vh'
	else
		assign aspect_ratio = image_ratio
		assign padding_bottom = 'calc(100vw / (var(--aspect_ratio)))'
	endif
%}

{% style %}
	{% render 'section-margin' %}

	#shopify-section-{{ section.id }} .image-banner {
	  --aspect_ratio: {{ aspect_ratio }};
	}

	#shopify-section-{{ section.id }} .image-banner__overlay {
	  opacity: {{ section.settings.overlay_opacity }};
	}

{% endstyle %}

{%- if section_heading != blank or section_subheading != blank -%}
		<div class='container background'>
			{%
				render 'section-header',
				section_heading: section_heading,
				section_subheading: section_subheading,
				section_heading_size: section.settings.section_heading_size,
				section_heading_tag: section.settings.section_heading_tag,
				dot: section.settings.dot,
			%}
		</div>
{%- endif -%}
<div
	class="image-banner-container {% if section.settings.animation and section.settings.image_ratio == 'large' %}animation{% endif %}" 
	data-animation={{ section.settings.animation }}
	data-image-ratio={{ section.settings.image_ratio }}
	>
	<div
		class='image-banner {{ image_ratio }} color-{{ section.settings.color_scheme }}'
		style='--aspect-ratio-image: {{ image_ratio }}; --aspect-ratio-adapt: {{ adapt_height }}'
	>
		{% if section.settings.heading != blank %}
			{% assign image_heading_tag = section.settings.image_heading_tag %}

			<{{ image_heading_tag }} class="image-banner__heading h2 color-{{section.settings.color_scheme}}">
				{{ section.settings.heading }}
			</{{ image_heading_tag }}>
		{% endif %}
		<div class='image-banner__container section-full-size'>
			{%- if section.settings.image != blank -%}
				<div class='image-banner__wrapper'>
					<div class='image-banner__media'>
						{% liquid
							assign width_adapt_ratio = 1
							if section.settings.image.width > section.settings.image.height
								assign width_adapt_ratio = 550 | times: section.settings.image.aspect_ratio | round: 2
							endif
							assign desktop_width = '100vw'
						%}
						{%- if section.settings.image != blank -%}
							{{
								section.settings.image
								| image_url: width: section.settings.image.width
								| image_tag:
									loading: 'lazy',
									sizes: '100vw',
									widths: '550, 1100, 1445, 1680, 1750, 1920, 2048, 2200, 2400, 2600, 2890, 3000, 3200, 3400, 3600, 3800, 4096'
							}}
						{%- endif -%}
					</div>
					{%- if section.settings.overlay_enable -%}
						<span class='image-banner__overlay'></span>
					{% endif %}
				</div>
			{% else %}
				{%- if section.settings.image_1 == blank -%}
					{{ 'hero-apparel-1' | placeholder_svg_tag }}
				{%- endif -%}
			{%- endif -%}
			{%- if section.settings.image_1 != blank -%}
				<div class='image-banner__wrapper'>
					<div class='image-banner__media'>
						{% liquid
							assign width_adapt_ratio = 1
							if section.settings.image_1.width > section.settings.image_1.height
								assign width_adapt_ratio = 550 | times: section.settings.image_1.aspect_ratio | round: 2
							endif
							assign desktop_width = '100vw'
						%}
						{% capture sizes %}
								(min-width: 1100px) {{ desktop_width }}, 
								{% if width_adapt_ratio != 1 %}
									{{ width_adapt_ratio }}px
								{% else %}
									100vw
								{% endif %}
							{% endcapture %}
						{%- if section.settings.image_1 != blank -%}
							{{
								section.settings.image_1
								| image_url: width: section.settings.image_1.width
								| image_tag:
									loading: 'lazy',
									sizes: sizes,
									widths: '375, 550, 750, 1100, 1500'
							}}
						{%- endif -%}
					</div>
					{%- if section.settings.overlay_enable -%}
						<span class='image-banner__overlay'></span>
					{% endif %}
				</div>
			{%- endif -%}
		</div>
	</div>
</div>

{% schema %}
{
	"name": "t:sections.image-banner.name",
	"tag": "section",
	"class": "image-banner-section spaced-section",
	"enabled_on": {
		"templates": ["*"]
	},
	"settings": [
		{
			"type": "color_scheme",
			"id": "color_scheme",
			"default": "background-1",
			"label": "t:sections.all.color_scheme.label",
			"info": "t:sections.image-banner.settings.color_scheme.info"
		},
		{
			"type": "text",
			"id": "heading",
			"default": "t:sections.image-banner.settings.heading.default",
			"label": "t:sections.image-banner.settings.heading.label"
		},
		{
			"type": "select",
			"id": "image_heading_tag",
			"label": "t:sections.image-banner.settings.heading_tag.label",
			"options": [
				{
					"value": "h1",
					"label": "H1"
				},
				{
					"value": "h2",
					"label": "H2"
				},
				{
					"value": "h3",
					"label": "H3"
				},
				{
					"value": "h4",
					"label": "H4"
				},
				{
					"value": "h5",
					"label": "H5"
				},
				{
					"value": "h6",
					"label": "H6"
				},
				{
					"value": "div",
					"label": "div"
				},
				{
					"value": "p",
					"label": "p"
				},
				{
					"value": "span",
					"label": "span"
				}
			],
			"default": "h2"
		},
		{
			"type": "header",
			"content": "t:sections.all.section-header.label"
		},
		{
			"type": "text",
			"id": "section_heading",
			"default": "t:sections.image-banner.settings.banner_heading.default",
			"label": "t:sections.all.section-header.heading.label"
		},
		{
			"type": "select",
			"id": "section_heading_tag",
			"label": "t:sections.all.heading.tag",
			"options": [
				{
					"value": "h1",
					"label": "H1"
				},
				{
					"value": "h2",
					"label": "H2"
				},
				{
					"value": "h3",
					"label": "H3"
				},
				{
					"value": "h4",
					"label": "H4"
				},
				{
					"value": "h5",
					"label": "H5"
				},
				{
					"value": "h6",
					"label": "H6"
				},
				{
					"value": "div",
					"label": "div"
				},
				{
					"value": "p",
					"label": "p"
				},
				{
					"value": "span",
					"label": "span"
				}
			],
			"default": "h2"
		},
		{
			"type": "select",
			"id": "section_heading_size",
			"options": [
				{
					"value": "h4",
					"label": "t:sections.all.heading_size.options__4.label"
				},
				{
					"value": "h3",
					"label": "t:sections.all.heading_size.options__1.label"
				},
				{
					"value": "h2",
					"label": "t:sections.all.heading_size.options__2.label"
				},
				{
					"value": "h1",
					"label": "t:sections.all.heading_size.options__3.label"
				}
			],
			"default": "h2",
			"label": "t:sections.all.heading_size.label"
		},
		{
			"type": "text",
			"id": "subheading",
			"default": "t:sections.image-banner.settings.subheading.default",
			"label": "t:sections.all.section-header.subheading.label"
		},
		{
			"type": "checkbox",
			"id": "dot",
			"default": true,
			"label": "t:sections.all.section-header.dot.label"
		},
		{
			"type": "header",
			"content": "t:sections.all.image.header.content",
			"info": "t:sections.image-banner.settings.heading.info"
		},
		{
			"type": "image_picker",
			"id": "image",
			"label": "t:sections.all.image.label"
		},
		{
			"type": "image_picker",
			"id": "image_1",
			"label": "t:sections.all.image.label"
		},
		{
			"type": "select",
			"id": "image_ratio",
			"default": "1/1",
			"label": "t:sections.all.image.aspect_ratio.label",
			"options": [
				{
					"value": "1/1",
					"label": "t:sections.all.image.aspect_ratio.options__1.label"
				},
				{
					"value": "3/2",
					"label": "t:sections.all.image.aspect_ratio.options__2.label"
				},
				{
					"value": "3/4",
					"label": "t:sections.all.image.aspect_ratio.options__3.label"
				},
				{
					"value": "4/3",
					"label": "t:sections.all.image.aspect_ratio.options__4.label"
				},
				{
					"value": "16/9",
					"label": "t:sections.all.image.aspect_ratio.options__5.label"
				},
				{
					"value": "21/9",
					"label": "t:sections.all.image.aspect_ratio.options__6.label"
				},
				{
					"value": "adapt",
					"label": "t:sections.all.image.aspect_ratio.options__7.label"
				},
				{
					"value": "large",
					"label": "t:sections.all.image.aspect_ratio.options__8.label"
				}
			]
		},
		{
			"type": "checkbox",
			"id": "animation",
			"default": false,
			"label": "t:sections.image-banner.settings.animation.label",
			"info": "t:sections.image-banner.settings.animation.info"
		},
		{
			"type": "header",
			"content": "t:sections.all.overlay.header.content"
		},
		{
			"type": "checkbox",
			"id": "overlay_enable",
			"default": true,
			"label": "t:sections.all.overlay.overlay_enable.label"
		},
		{
			"type": "range",
			"id": "overlay_opacity",
			"min": 0,
			"max": 1,
			"step": 0.1,
			"default": 0.2,
			"label": "t:sections.all.overlay.overlay_opacity.label"
		},
		{
			"type": "header",
			"content": "t:sections.all.section-margin.header.content"
		},
		{
			"type": "select",
			"id": "margin_top",
			"options": [
				{
					"value": "no-indent",
					"label": "t:sections.all.section-margin.options__1.label"
				},
				{
					"value": "xs",
					"label": "t:sections.all.section-margin.options__2.label"
				},
				{
					"value": "s",
					"label": "t:sections.all.section-margin.options__3.label"
				},
				{
					"value": "m",
					"label": "t:sections.all.section-margin.options__4.label"
				},
				{
					"value": "l",
					"label": "t:sections.all.section-margin.options__5.label"
				},
				{
					"value": "xl",
					"label": "t:sections.all.section-margin.options__6.label"
				}
			],
			"default": "m",
			"label": "t:sections.all.section-margin.margin_top.label"
		},
		{
			"type": "select",
			"id": "margin_bottom",
			"options": [
				{
					"value": "no-indent",
					"label": "t:sections.all.section-margin.options__1.label"
				},
				{
					"value": "xs",
					"label": "t:sections.all.section-margin.options__2.label"
				},
				{
					"value": "s",
					"label": "t:sections.all.section-margin.options__3.label"
				},
				{
					"value": "m",
					"label": "t:sections.all.section-margin.options__4.label"
				},
				{
					"value": "l",
					"label": "t:sections.all.section-margin.options__5.label"
				},
				{
					"value": "xl",
					"label": "t:sections.all.section-margin.options__6.label"
				}
			],
			"default": "m",
			"label": "t:sections.all.section-margin.margin_bottom.label"
		}
	],
	"presets": [
		{
			"name": "t:sections.image-banner.presets.name"
		}
	]
}
{% endschema %}
