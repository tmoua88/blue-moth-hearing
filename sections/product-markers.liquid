{{ 'section-product-markers.css' | asset_url | stylesheet_tag }}
<script
	src='{{ 'section-product-markers.js' | asset_url }}'
	defer='defer'
></script>
{% style %}
	{% render 'section-padding' %}
	  {% render 'section-margin' %}
	  #shopify-section-{{ section.id }} {
	  	--letter-spacing: {{ section.settings.letter_spacing }}em;
	  }
	  #shopify-section-{{ section.id }} .have-overlay {
	  	--overlay-alpha : {{ section.settings.overlay_opacity }}%;

	position: relative;
	  &::before {
	  	content: "";
	  	position: absolute;
	  	width: 100%;
	  	height: 100%;
	  	top: 0;
	  	left: 0;
	  	z-index: -1;
	  	pointer-events: none;
	  	transition: all 0.4s ease;
	  	background: rgba(var(--color-overlay), var(--overlay-alpha));
	  }
	  }
{% endstyle %}

<div class='product-markers section-{{ section.id }}-padding  background {% if section.settings.show_border_top %} product-markers--border-top{% endif %} {% if section.settings.show_border_bottom %} product-markers--border-bottom {% endif %}'>
	<div class='product-markers__wrapper'>
		<div class='container'>
			{% render 'section-header',
				section_heading: section.settings.section_heading,
				section_subheading: section.settings.subheading,
				section_heading_size: section.settings.section_heading_size,
				section_heading_tag: section.settings.heading_tag,
				dot: section.settings.dot,
				line: section.settings.line
			%}
			<div class='product-markers__box'>
				<div class='product-markers__img'>
					<div class='product-markers__img-box'>
						{% for block in section.blocks %}
							{% liquid
								assign x = block.settings.position_x
								assign y = block.settings.position_y
								if x >= 50
									assign horizontal_position = 'right'
									assign x = 100 | minus: x
								else
									assign horizontal_position = 'left'
								endif
								if y >= 50
									assign y = 100 | minus: y
									assign vertical_position = ' bottom'
								else
									assign vertical_position = ' top'
								endif

								assign marker_classes = horizontal_position | append: vertical_position
								if forloop.index == 1
									assign marker_classes = marker_classes | append: ' active'
								endif
							%}
							<div
								class='product-markers__marker color-{{ section.settings.color_scheme }} js-product-markers__item {{ marker_classes }}'
								data-index='{{ forloop.index }}'
								style='{{ horizontal_position }} : {{ x }}%; {{ vertical_position }} : {{ y }}%'
							>
								<div class='card-wrapper'>
									<div
										class='product-markers__card'
									>
										<div
											data-index='{{ forloop.index }}'
											class='product-markers__product js-product-markers__item-inner collection-product-card'
										>	
											{% liquid
												assign image_size = block.settings.image_size
												assign image_height = block.settings.image.width | divided_by: block.settings.image.aspect_ratio

												case image_size
													when 'adapt'
														if block.settings.video != blank
															assign section_size = 1 | divided_by: block.settings.video.aspect_ratio | times: 100 | append: '%'
														else 
															assign section_size = 1 | divided_by: block.settings.image.aspect_ratio | times: 100 | append: '%'
														endif
												endcase
											%}
											{% if block.settings.image != blank or block.settings.video != blank %}		
												<div class="product-markers__product_img {{ image_size }}" style="--slide-height: {{ section_size }}; {% if block.settings.image != blank or block.settings.video != blank %}aspect-ratio: {{ image_size }}{% endif %}">
													{%- if block.settings.video != blank -%}
														{% liquid
															assign video_height = block.settings.video.sources[0].width | divided_by: block.settings.video.aspect_ratio
														%}
														{{
															block.settings.video
															| video_tag:
																width: block.settings.video.sources[0].width,
																height: video_height,
																autoplay: true,
																loop: true,
																controls: false,
																muted: true
														}}
													{%  endif %}
													{%- if block.settings.image != blank and block.settings.video == blank -%}
														{% assign image_height = block.settings.image.width
															| divided_by: block.settings.image.aspect_ratio
														%}
														{{
															block.settings.image
															| image_url: width: 3840
															| image_tag:
																loading: 'lazy',
																width: block.settings.image.width,
																height: image_height,
																sizes: '100vw (min-width: 767px) 50vw',
																widths: '375, 550, 750, 1100, 1500, 1780, 2000, 3000, 3840',
																class: 'jarallax-img'
																
														}}
													{%- endif -%}
												</div>
											{% endif %}
											{%- if block.settings.icon_item != blank -%}
												{%- render 'icon-accordion',
													icon: block.settings.icon_item,
													size: section.settings.icon_size,
													custom_icon: block.settings.custom_icon,
													custom_icon_dark: block.settings.custom_icon_dark
												-%}
											{%- else -%}
												{{
													'detailed-apparel-1'
													| placeholder_svg_tag: 'placeholder-svg'
												}}
											{%- endif -%}

											{%- if block.settings.heading != blank -%}
												<h6 class='product-heading'>
													{{ block.settings.heading }}
												</h6>
											{%- endif -%}

											{%- if block.settings.description != blank -%}
												<div class='product-description'>
													{{ block.settings.description }}
												</div>
											{%- endif -%}
										</div>
									</div>
								</div>

								{% render 'icon-plus', custom_class: 'marker-icon-plus' %}
							</div>
						{% endfor %}
						<div class='product-markers__overlay have-overlay  product-markers__media'>
							{%- if section.settings.image != blank -%}
								{% assign image_height = section.settings.image.width
									| divided_by: section.settings.image.aspect_ratio
								%}

								{{
									section.settings.image
									| image_url: width: 1780
									| image_tag:
										loading: 'lazy',
										width: section.settings.image.width,
										height: image_height,
										sizes: '100vw',
										widths: '375, 550, 750, 1100, 1500, 1780'
								}}
							{%- else -%}
								{{
									'detailed-apparel-1'
									| placeholder_svg_tag: 'placeholder-svg placeholder'
								}}
							{%- endif -%}
						</div>
					</div>
					<div class='product-markers-for-mobile'>
						{%- for block in section.blocks -%}
							<div
								data-index='{{ forloop.index }}'
								class='product-markers__product js-product-markers__item-inner collection-product-card'
							>
								{%- if block.settings.icon_item != blank -%}
									{%- render 'icon-accordion',
										icon: block.settings.icon_item,
										size: section.settings.icon_size,
										custom_icon: block.settings.custom_icon,
										custom_icon_dark: block.settings.custom_icon_dark
									-%}
								{%- else -%}
									{{
										'product-apparel-2'
										| placeholder_svg_tag: 'placeholder-svg'
									}}
								{%- endif -%}

								{%- if block.settings.heading != blank -%}
									<h6 class='product-heading'>
										{{ block.settings.heading }}
									</h6>
								{%- endif -%}

								{%- if block.settings.description != blank -%}
									<div class='product-description'>
										{{ block.settings.description }}
									</div>
								{%- endif -%}
							</div>
						{% endfor %}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

{% schema %}
{
	"name": "t:sections.product_markers.name",
	"tag": "section",
	"class": "product-markers-section spaced-section",
	"enabled_on": {
		"templates": ["*"]
	},
	"settings": [
		{
			"type": "color_scheme",
			"id": "color_scheme",
			"default": "background-2",
			"label": "t:sections.all.color_scheme.label"
		},
		{
			"type": "header",
			"content": "t:sections.all.section-header.label"
		},
		{
			"type": "text",
			"id": "section_heading",
			"label": "t:sections.all.section-header.heading.label",
			"default": "t:sections.product_markers.settings.heading.label"
		},
		{
			"type": "select",
			"id": "heading_tag",
			"label": "t:sections.all.heading.tag",
			"options": [
				{
					"value": "h1",
					"label": "H1"
				},
				{
					"value": "h2",
					"label": "H2"
				},
				{
					"value": "h3",
					"label": "H3"
				},
				{
					"value": "h4",
					"label": "H4"
				},
				{
					"value": "h5",
					"label": "H5"
				},
				{
					"value": "h6",
					"label": "H6"
				},
				{
					"value": "div",
					"label": "div"
				},
				{
					"value": "p",
					"label": "p"
				},
				{
					"value": "span",
					"label": "span"
				}
			],
			"default": "h2"
		},
		{
			"type": "select",
			"id": "section_heading_size",
			"options": [
				{
					"value": "h4",
					"label": "t:sections.all.heading_size.options__4.label"
				},
				{
					"value": "h3",
					"label": "t:sections.all.heading_size.options__1.label"
				},
				{
					"value": "h2",
					"label": "t:sections.all.heading_size.options__2.label"
				},
				{
					"value": "h1",
					"label": "t:sections.all.heading_size.options__3.label"
				}
			],
			"default": "h2",
			"label": "t:sections.all.heading_size.label"
		},
		{
			"type": "text",
			"id": "subheading",
			"label": "t:sections.all.section-header.subheading.label"
		},
		{
			"type": "checkbox",
			"id": "dot",
			"default": false,
			"label": "t:sections.all.section-header.dot.label"
		},
		{
			"type": "checkbox",
			"id": "line",
			"default": false,
			"label": "t:sections.all.section-header.line.label",
			"info": "t:sections.all.section-header.line.info"
		},
		{
			"type": "header",
			"content": "t:sections.all.image.header.content"
		},
		{
			"type": "image_picker",
			"id": "image",
			"label": "t:sections.all.image.label"
		},
		{
			"type": "range",
			"id": "overlay_opacity",
			"min": 0,
			"max": 100,
			"default": 0,
			"unit": "%",
			"label": "t:sections.all.overlay.overlay_opacity.label_secondary"
		},

		{
			"type": "header",
			"content": "t:sections.all.section-margin.header.content"
		},
		{
			"type": "select",
			"id": "margin_top",
			"options": [
				{
					"value": "no-indent",
					"label": "t:sections.all.section-margin.options__1.label"
				},
				{
					"value": "xs",
					"label": "t:sections.all.section-margin.options__2.label"
				},
				{
					"value": "s",
					"label": "t:sections.all.section-margin.options__3.label"
				},
				{
					"value": "m",
					"label": "t:sections.all.section-margin.options__4.label"
				},
				{
					"value": "l",
					"label": "t:sections.all.section-margin.options__5.label"
				},
				{
					"value": "xl",
					"label": "t:sections.all.section-margin.options__6.label"
				}
			],
			"default": "xs",
			"label": "t:sections.all.section-margin.margin_top.label"
		},
		{
			"type": "select",
			"id": "margin_bottom",
			"options": [
				{
					"value": "no-indent",
					"label": "t:sections.all.section-margin.options__1.label"
				},
				{
					"value": "xs",
					"label": "t:sections.all.section-margin.options__2.label"
				},
				{
					"value": "s",
					"label": "t:sections.all.section-margin.options__3.label"
				},
				{
					"value": "m",
					"label": "t:sections.all.section-margin.options__4.label"
				},
				{
					"value": "l",
					"label": "t:sections.all.section-margin.options__5.label"
				},
				{
					"value": "xl",
					"label": "t:sections.all.section-margin.options__6.label"
				}
			],
			"default": "xs",
			"label": "t:sections.all.section-margin.margin_bottom.label"
		}
	],
	"blocks": [
		{
			"type": "marker",
			"name": "t:sections.product_markers.blocks.name",
			"settings": [
				{
					"type": "range",
					"id": "position_x",
					"min": 0,
					"max": 100,
					"default": 20,
					"step": 1,
					"unit": "%",
					"label": "t:sections.product_markers.blocks.settings.marker.position_x"
				},
				{
					"type": "range",
					"id": "position_y",
					"min": 0,
					"max": 100,
					"default": 30,
					"step": 1,
					"unit": "%",
					"label": "t:sections.product_markers.blocks.settings.marker.position_y"
				},
				{
					"type": "image_picker",
					"id": "image",
					"label": "t:sections.all.image.label"
				},
				{
					"type": "video",
					"id": "video",
					"label": "t:sections.all.video.label"
				},
				{
					"type": "select",
					"id": "image_size",
					"default": "16/9",
					"label": "t:sections.all.image.aspect_ratio.label",
					"options": [
						{
							"value": "1/1",
							"label": "t:sections.slideshow.settings.height.options__1.label"
						},
						{
							"value": "3/2",
							"label": "t:sections.slideshow.settings.height.options__2.label"
						},
						{
							"value": "4/3",
							"label": "t:sections.slideshow.settings.height.options__3.label"
						},
						{
							"value": "16/9",
							"label": "t:sections.slideshow.settings.height.options__4.label"
						},
						{
							"value": "21/9",
							"label": "t:sections.slideshow.settings.height.options__5.label"
						},
						{
							"value": "adapt",
							"label": "t:sections.slideshow.settings.height.options__6.label"
						}
					]
				},
				{
					"type": "select",
					"id": "icon_item",
					"options": [
						{
							"value": "none",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.none"
						},
						{
							"value": "icon_1",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.icon_1"
						},
						{
							"value": "icon_2",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.icon_2"
						},
						{
							"value": "icon_3",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.icon_3"
						},
						{
							"value": "icon_4",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.icon_4"
						},
						{
							"value": "icon_5",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.icon_5"
						},
						{
							"value": "icon_6",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.icon_6"
						},
						{
							"value": "icon_7",
							"label": "t:sections.all.icons_accardion.settings.icon.icons.icon_7"
						}
					],
					"default": "icon_1",
					"label": "t:sections.all.icons_accardion.settings.icon.label"
				},
				{
					"type": "inline_richtext",
					"id": "heading",
					"label": "t:sections.all.heading.label",
					"default": "t:sections.product_markers.settings.heading.default"
				},
				{
					"type": "richtext",
					"id": "description",
					"default": "t:sections.product_markers.settings.description.default",
					"label": "t:sections.all.text.label"
				}
			]
		}
	],
	"presets": [
		{
			"name": "t:sections.product_markers.name",
			"blocks": [
				{
					"type": "marker",
					"settings": {
						"position_x": 55,
						"position_y": 25
					}
				},
				{
					"type": "marker",
					"settings": {
						"position_x": 40,
						"position_y": 60
					}
				},
				{
					"type": "marker",
					"settings": {
						"position_x": 45,
						"position_y": 75
					}
				}
			]
		}
	]
}
{% endschema %}
