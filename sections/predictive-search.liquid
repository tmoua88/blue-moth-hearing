{% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
{{ 'component-loading-overlay.css' | asset_url | stylesheet_tag }}
{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-badge.css' | asset_url | stylesheet_tag }}


{%- if settings.quickview_show or settings.show_on_mobile or settings.type_color_swatch == 'custom' -%}
  {{ 'section-main-product.css' | asset_url | stylesheet_tag }}
{% endif %}

{%- if settings.quickview_show or settings.show_on_mobile -%}
  <link rel="stylesheet" href="{{ 'component-deferred-media.css' | asset_url }}" media="all">
  <link
    rel="preload"
    href="{{ 'quick-add.css' | asset_url }}"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  >
{%- endif -%}

{%- if predictive_search.performed -%}
  <div id="predictive-search-results" role="listbox" tabIndex="-1">
    {%- if predictive_search.resources.products.size > 0
      or predictive_search.resources.collections.size > 0
      or predictive_search.resources.articles.size > 0
      or predictive_search.resources.pages.size > 0
    -%}
      <div
        id="predictive-search-results-groups-wrapper"
        class="predictive-search__results-groups-wrapper{% unless predictive_search.resources.products.size > 0 %} predictive-search__results-groups-wrapper--no-products{% endunless %}{% unless predictive_search.resources.queries.size > 0 or predictive_search.resources.collections.size > 0 %} predictive-search__results-groups-wrapper--no-suggestions{% endunless %}"
      >
        <div class="predictive-search__result-group">
          <div class="predictive-search__result-tabs">
            {%- if predictive_search.resources.products.size > 0 -%}
              <div class="predictive-search__result-tab section-header__subtitle active" data-type-target="products">
                <span class="predictive-search__result-tab-title section-header__subtitle subheading">{{ 'general.search.products' | t }}</span>
              </div>
            {% endif %}
            {%- if predictive_search.resources.articles.size > 0 -%}
              <div class="predictive-search__result-tab section-header__subtitle" data-type-target="articles">
                <span class="predictive-search__result-tab-title section-header__subtitle subheading">{{ 'general.search.articles' | t }}</span>
              </div>
            {% endif %}
            {%- if predictive_search.resources.collections.size > 0 -%}
              <div class="predictive-search__result-tab subheading section-header__subtitle" data-type-target="collections">
                <span class="predictive-search__result-tab-title section-header__subtitle subheading">{{ 'general.search.collections' | t }}</span>
              </div>
            {% endif %}
            {%- if predictive_search.resources.pages.size > 0 -%}
              <div class="predictive-search__result-tab section-header__subtitle" data-type-target="pages">
                <span class="predictive-search__result-tab-title section-header__subtitle subheading">{{ 'general.search.pages' | t }}</span>
              </div>
            {% endif %}
          </div>
          {%- if predictive_search.resources.products.size > 0 -%}
            <div>
              <ul
                id="predictive-search-results-products-list"
                class="predictive-search__results-list predictive-search__results-list_products list-unstyled"
                role="group"
                aria-labelledby="predictive-search-products"
                tabIndex="-1"
                data-type="products"
              >
                {%- for product in predictive_search.resources.products -%}
                  <li
                    id="predictive-search-option-product-{{ forloop.index }}"
                    class="predictive-search__list-item collection-product-card quickview--hover"
                    role="option"
                    aria-selected="false"
                  >
                    {% render 'product-card',
                      product_card_product: product,
                      product_heading_tag: settings.product_heading_tag
                      media_size: settings.search_media_size,
                      media_fit: settings.search_media_fit,
                      show_secondary_image: settings.search_show_secondary_image,
                      show_vendor: settings.search_show_vendor,
                      show_collection_name: settings.search_show_collection,
                      show_desc: settings.search_show_desc,
                      show_sku: false
                    %}
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
          {%- if predictive_search.resources.collections.size > 0 -%}
            <div class="predictive-search__pages-wrapper">
              <ul
                id="predictive-search-results-pages-list-mobile"
                class="predictive-search__results-list predictive-search__results-list_collections list-unstyled"
                role="group"
                aria-labelledby="predictive-search-pages-mobile"
                data-type="collections"
              >
                {% style %}
                  .predictive-search__list-item.collection-product-card .collections-grid__item {
                    --aspect-ratio: {{ settings.search_categories_image_ratio }};
                  }
                {% endstyle %}
                {%- for collection in predictive_search.resources.collections -%}
                  <li
                    id="predictive-search-option-article-mobile-{{ forloop.index }}"
                    class="predictive-search__list-item collections-grid__card collection-product-card"
                    role="option"
                    aria-selected="false"
                  >
                    <div class="collections-grid__item">
                      <div class="collections-grid__item-inner">
                        <div class="collections-grid__image">
                          {% if collection.featured_image != blank %}
                            {% liquid
                              assign aspect_ratio = settings.search_categories_image_ratio | split: '/'
                              assign temp = aspect_ratio[0] | append: '.0'
                              assign padding_bottom = aspect_ratio[1] | divided_by: temp | times: 100 | round: 2

                              assign width_ratio = 1
                              assign aspect_ratio_img = collection.featured_image.aspect_ratio | round: 2
                              assign aspect_ratio_settings = aspect_ratio[0] | plus: 0.0 | divided_by: aspect_ratio[1] | round: 2

                              if aspect_ratio_img > aspect_ratio_settings
                                assign width_ratio = aspect_ratio_img | divided_by: aspect_ratio_settings | round: 2
                              endif
                            %}

                            {%- capture sizes -%}
                              (min-width: 750px) calc(300px * {{ width_ratio }}),
                              calc((100vw - 40px) * {{ width_ratio }})
                            {%- endcapture -%}
                            {%- capture style -%}
                                object-fit: {{ settings.search_categories_object_fit }};
                              {%- endcapture -%}
                            {{
                              collection.featured_image
                              | image_url: width: collection.featured_image.width
                              | image_tag:
                                loading: 'lazy',
                                sizes: sizes,
                                widths: '360, 535, 720, 940, 1070, 1200, 1500, 1780',
                                style: style
                            }}
                          {% else %}
                            {{ 'detailed-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
                          {% endif %}
                        </div>
                      </div>

                      <h3 class="collections-grid__item-title h5">
                        {{ collection.title }}
                      </h3>
                      {% if collection.all_products_count > 0 %}
                        <div class="collections-grid__item-count section-header__subtitle subheading">
                          {{ 'general.search.item_count' | t: count: collection.all_products_count }}
                        </div>
                      {% endif %}
                      <a
                        href="{{ collection.url }}"
                        class="collections-grid__overlay-link"
                        aria-label="{{ collection.tittle }}"
                      ></a>
                    </div>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {% endif %}
          {%- if predictive_search.resources.articles.size > 0 -%}
            <div class="predictive-search__pages-wrapper">
              <ul
                id="predictive-search-results-pages-list-mobile"
                class="predictive-search__results-list predictive-search__results-list_articles list-unstyled"
                role="group"
                aria-labelledby="predictive-search-pages-mobile"
                data-type="articles"
                style="--aspect-ratio: {{ settings.search_article_image_ratio }};"
              >
                {%- for article in predictive_search.resources.articles -%}
                  <li
                    id="predictive-search-option-article-mobile-{{ forloop.index }}"
                    class="predictive-search__list-item collection-product-card"
                    role="option"
                    aria-selected="false"
                  >
                    {% render 'article-card',
                      article: article,
                      show_image: settings.predictive_search_show_image,
                      show_tags: settings.predictive_search_show_tags,
                      show_date: settings.predictive_search_show_date,
                      show_author: settings.predictive_search_show_author,
                      show_excerpt: settings.predictive_search_show_excerpt,
                      heading_tag: settings.predictive_search_article_heading_tag
                    %}
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {%- endif -%}
          {%- if predictive_search.resources.pages.size > 0 -%}
            <div class="predictive-search__pages-wrapper">
              <ul
                id="predictive-search-results-pages-list-mobile"
                class="predictive-search__results-list predictive-search__results-list_pages list-unstyled"
                role="group"
                aria-labelledby="predictive-search-pages-mobile"
                data-type="pages"
                style="--aspect-ratio: {{ settings.search_page_card_ratio }};"
              >
                {%- for page in predictive_search.resources.pages -%}
                  <li
                    id="predictive-search-option-article-mobile-{{ forloop.index }}"
                    class="predictive-search__list-item"
                    role="option"
                    aria-selected="false"
                  >
                    <a href="{{ page.url }}" class="card-page__wrapper">
                      <div class="card-page color-{{ settings.color_scheme_page }}">
                        <div class="card-page__content">
                          <h3 class="card-page__title">
                            {{ page.title | truncate: 50 | escape }}
                          </h3>
                        </div>
                      </div>
                    </a>
                  </li>
                {%- endfor -%}
              </ul>
            </div>
          {% endif %}
        </div>
      </div>
    {%- endif -%}

    <div class="predictive-search__loading-state" aria-hidden="true">
      {% render 'icon-spinner' %}
    </div>
  </div>

  {%- if predictive_search.resources.products.size == 0
    and predictive_search.resources.collections.size == 0
    and predictive_search.resources.articles.size == 0
    and predictive_search.resources.pages.size == 0
  -%}
    <p class="predictive-search__text">
      {{ 'templates.search.no_results' | t: terms: predictive_search.terms }}
    </p>
  {% endif %}

  <span class="hidden" data-predictive-search-live-region-count-value>
    {% liquid
      assign total_results = predictive_search.resources.products.size
      echo 'templates.search.results_with_count' | t: count: total_results, terms: predictive_search.terms
    %}
  </span>
{%- endif -%}
